<project name="install tomcat cmd" basedir="." default="cmd">
	
	<!-- 
	#########################################
	# Install Tomcat Engine & Tocmat Instance
	#########################################
	-->
	
	<property file="${basedir}/build.properties" />
	
	<property name="meerkat.agent.home" value="${agent.deploy.dir}/${agent.name}" />
	<property name="down.dir" value="${agent.deploy.dir}/${agent.name}/downloads" />

	<taskdef resource="cargo.tasks">
		<classpath>
			<pathelement location="${meerkat.agent.home}/lib/cargo-core-uberjar-1.4.19.jar" />
			<pathelement location="${meerkat.agent.home}/lib/cargo-ant-1.4.19.jar" />
		</classpath>
	</taskdef>

	<target name="cmd">

		<echo message="making ${catalina.home}" />
		<mkdir dir="${catalina.home}" />
		
		<echo message="making ${catalina.base}" />
		<mkdir dir="${catalina.base}" />

		<echo message="Installing Tomcat..." />

		<cargo containerId="tomcat7x" action="configure">
			<zipUrlInstaller 
					installUrl="http://192.168.0.87:8080/down/apache-tomcat-7.0.68.zip" 
					downloadDir="${down.dir}" 
					extractDir="${down.dir}" />
			
			<configuration home="${catalina.base}">
				<property name="cargo.servlet.port" 		value="${ti.http.port}"/>
				<property name="cargo.tomcat.ajp.port" 		value="${ti.ajp.port}"/>
				<property name="cargo.tomcat.uriencoding" 	value="${ti.http.encoding}"/>
				<!-- <property name="cargo.rmi.port"				value="${ti.rmi.port}" /> -->
			</configuration>
		</cargo>
		
		<copy todir="${catalina.home}" >
			<fileset dir="${down.dir}/${tomcat.name}/${tomcat.name}"/>
		</copy>

		<copy todir="${catalina.base}" verbose="true">
		    <fileset dir="${meerkat.agent.home}/scripts" defaultexcludes="true">
		      <include name="*"/>
		    </fileset>
		</copy>

		<chmod dir="${catalina.home}" perm="755" includes="**/*.sh"/>
		<chmod dir="${catalina.base}" perm="755" includes="**/*.sh"/>

	</target>

</project>
